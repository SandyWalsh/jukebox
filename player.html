<html>
<head>
    <script src="https://cdn.goinstant.net/client/platform.min.js"></script>    
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="swfobject.js"></script>
    <script type="text/javascript">
        var playlistCollection;

        $( document ).ready(function() {
            var url = 'https://goinstant.net/jukebox/jukebox/123';
            goinstant.connect(url, function(err, platform, session) {
              if (err) {
                console.log('error connecting');
                return;
              }

              playlistCollection = session.collection('/playlist');

              play_firstsong();    
            });  
        });
        
        function play_firstsong() {
            playlistCollection.get(function(err, data, keys) {
                if (err) {
                    console.log("Could not get collection");
                } else {
                    createPlayer(data[0].vid);
                    keys[0].remove;
                }
            });
        }  
          
        // This function is called when an error is thrown by the player
        function onPlayerError(errorCode) {
            console.log("An error occured of type:" + errorCode);
        }

        // This function is called when the player changes state
        function onPlayerStateChange(newState) {
            console.log("State Changed" + newState);

            if(newState == "0") {
                console.log("Song stopped, request a new one.");
                play_firstsong();
            }
        }
       
        // This function is automatically called by the player once it loads
        function onYouTubePlayerReady(playerId) {            
            console.log("YouTube Player is Ready");
            
            ytplayer = document.getElementById("ytPlayer");

            ytplayer.addEventListener("onStateChange", "onPlayerStateChange");
            ytplayer.addEventListener("onError", "onPlayerError");
        }
                
        function createPlayer(videoId) {
            console.log("Creating New Video Player");
            
            //Destroy Old Video
            swfobject.removeSWF("ytPlayer");
            
            //Add New Element
            var e = $('<div></div>');
            e.attr('id', 'ytapiplayer');
            $('body').append(e);
            
            var params = { allowScriptAccess: "always" };
            var atts = { id: "ytPlayer" };
            
            swfobject.embedSWF("http://www.youtube.com/v/" + videoId + "?enablejsapi=1&playerapiid=ytplayer&version=3&autoplay=1",
                               "ytapiplayer", "100%", "100%", "8", null, null, params, atts);
        } 
      </script>
    
</head>
<body> 
</body>
</html>

